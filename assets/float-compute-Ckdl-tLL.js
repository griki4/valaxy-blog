import{_ as d}from"./ValaxyMain.vue_vue_type_script_setup_true_lang-BHBywirc.js";import{e as D,w as a,f as y,a as A,p as F,b as g,g as i,h as s,x as o,r as k}from"./app-BkYZ_hAF.js";const B={__name:"float-compute",setup(E,{expose:r}){const h=JSON.parse('{"title":"JS中的浮点数计算精度问题","description":"","frontmatter":{"title":"JS中的浮点数计算精度问题","excerpt_type":"md","categories":["Frontend","JavaScript","DataType"],"tags":["JavaScript"]},"headers":[{"level":2,"title":"解决方案","slug":"解决方案","link":"#解决方案","children":[]}],"relativePath":"pages/posts/frontend/JavaScript/DataType/float-compute.md","path":"/home/runner/work/valaxy-blog/valaxy-blog/pages/posts/frontend/JavaScript/DataType/float-compute.md","lastUpdated":1731665532000}'),n=A(),e=h.frontmatter||{};return n.meta.frontmatter=Object.assign(n.meta.frontmatter||{},h.frontmatter||{}),F("pageData",h),F("valaxy:frontmatter",e),globalThis.$frontmatter=e,r({frontmatter:{title:"JS中的浮点数计算精度问题",excerpt_type:"md",categories:["Frontend","JavaScript","DataType"],tags:["JavaScript"]}}),(l,t)=>{const p=d;return g(),D(p,{frontmatter:y(e)},{"main-content-md":a(()=>[t[0]||(t[0]=i("p",null,[s("在JS中有一个经典的问题，就是 0.1 + 0.2 为什么不等于 0.3。在JS中输入 "),i("code",null,"0.1 + 0.2 === 0.3"),s(" 返回的结果是 false，说明JS认为两侧的结果不相等，这似乎违背了数学常识。 实际上这并非 JavaScript 这一门编程语言的问题，各种编程语言对于类似"),i("strong",null,"浮点数的计算"),s("都不太能把握得住。")],-1)),t[1]||(t[1]=i("p",null,"计算机中，数字都是以二进制的形式存储的，包括在计算的过程中。虽然我们看到的都是十进制的数字，但是实际上计算机是将十进制的数字转换为二进制之后计算然后再输出十进制的。",-1)),t[2]||(t[2]=i("p",null,[s("简单来说就是计算机将 0.1 和 0.2 这两个数字转换为二进制存储后计算，然后将计算结果再转换为十进制呈现。小数转为二进制的规则是小数乘以2然后取整数部分，不断循环直至小数部分为0。但是 0.1 和 0.2 这两个小数转为二进制的时候都会存在无限循环的情况，而"),i("code",null,"IEEE754"),s("标准规定存储的二进制最大位数为从第一个1开始的后"),i("strong",null,"53"),s("位，最后第54位采用0舍1入的方式，也即是近似存储。 正式由于这样才导致了计算时的误差。也就是我们看见的")],-1)),t[3]||(t[3]=i("blockquote",null,[i("p",null,"0.1 + 0.2 = 0.30000000000000004 （小数点后17位）")],-1)),t[4]||(t[4]=i("p",null,"由于存储的结果是近似值，那么计算出的结果自然也不准确，因此计算结果最后转换为十进制的时候就不是严格等于0.3了。",-1)),o(" more "),t[5]||(t[5]=i("p",null,[s("掘金上林三心大佬的文章写的很清晰。"),i("a",{href:"https://juejin.cn/post/7041546152994406430",target:"_blank",rel:"noreferrer"},"0.1 + 0.2 != 0.3")],-1)),t[6]||(t[6]=i("h2",{id:"解决方案",tabindex:"-1"},[s("解决方案 "),i("a",{class:"header-anchor",href:"#解决方案","aria-label":'Permalink to "解决方案"'},"​")],-1)),t[7]||(t[7]=i("p",null,"首先最明智的方案就是不要使用JS来进行浮点数的计算，并且避免把浮点数计算的结果作为项目中的某些重要逻辑的依据。但是如果业务中对浮点数计算有强制需求，可以参考下面两种方案。",-1)),t[8]||(t[8]=i("ul",null,[i("li",null,[i("strong",null,"使用第三方库"),s(),i("a",{href:"https://github.com/MikeMcl/big.js/",target:"_blank",rel:"noreferrer"},[i("strong",null,"Big.js")]),s("。提供了使用JS进行任意精度运算的能力。")]),i("li",null,[i("strong",null,"手动引入Number.EPSILON"),s("。MDN对此的解释：Number.EPSILON静态数据属性表示 1 与大于 1 的最小浮点数之间的差值。如果 0.1 + 0.2 和 0.3之 间的误差值小于 Number.EPSILON 这个“机器精度”数字，可以认为两者相等。")])],-1)),t[9]||(t[9]=i("div",{class:"language-javascript vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"javascript"),i("pre",{class:"shiki shiki-themes material-theme-darker material-theme-lighter vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#C792EA","--shiki-light":"#9C3EDA"}},"function"),i("span",{style:{"--shiki-dark":"#82AAFF","--shiki-light":"#6182B8"}}," equal"),i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-light":"#39ADB5"}},"("),i("span",{style:{"--shiki-dark":"#EEFFFF","--shiki-dark-font-style":"italic","--shiki-light":"#90A4AE","--shiki-light-font-style":"italic"}},"x"),i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-light":"#39ADB5"}},","),i("span",{style:{"--shiki-dark":"#EEFFFF","--shiki-dark-font-style":"italic","--shiki-light":"#90A4AE","--shiki-light-font-style":"italic"}}," y"),i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-light":"#39ADB5"}},")"),i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-light":"#39ADB5"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-dark-font-style":"italic","--shiki-light":"#39ADB5","--shiki-light-font-style":"italic"}},"  return"),i("span",{style:{"--shiki-dark":"#EEFFFF","--shiki-light":"#90A4AE"}}," Math"),i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-light":"#39ADB5"}},"."),i("span",{style:{"--shiki-dark":"#82AAFF","--shiki-light":"#6182B8"}},"abs"),i("span",{style:{"--shiki-dark":"#F07178","--shiki-light":"#E53935"}},"("),i("span",{style:{"--shiki-dark":"#EEFFFF","--shiki-light":"#90A4AE"}},"x"),i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-light":"#39ADB5"}}," -"),i("span",{style:{"--shiki-dark":"#EEFFFF","--shiki-light":"#90A4AE"}}," y"),i("span",{style:{"--shiki-dark":"#F07178","--shiki-light":"#E53935"}},") "),i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-light":"#39ADB5"}},"<"),i("span",{style:{"--shiki-dark":"#EEFFFF","--shiki-light":"#90A4AE"}}," Number"),i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-light":"#39ADB5"}},"."),i("span",{style:{"--shiki-dark":"#F07178","--shiki-light":"#E53935"}},"EPSILON"),i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-light":"#39ADB5"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-light":"#39ADB5"}},"}")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#C792EA","--shiki-light":"#9C3EDA"}},"const"),i("span",{style:{"--shiki-dark":"#EEFFFF","--shiki-light":"#90A4AE"}}," x "),i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-light":"#39ADB5"}},"="),i("span",{style:{"--shiki-dark":"#F78C6C","--shiki-light":"#F76D47"}}," 0.2"),i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-light":"#39ADB5"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#C792EA","--shiki-light":"#9C3EDA"}},"const"),i("span",{style:{"--shiki-dark":"#EEFFFF","--shiki-light":"#90A4AE"}}," y "),i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-light":"#39ADB5"}},"="),i("span",{style:{"--shiki-dark":"#F78C6C","--shiki-light":"#F76D47"}}," 0.3"),i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-light":"#39ADB5"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#C792EA","--shiki-light":"#9C3EDA"}},"const"),i("span",{style:{"--shiki-dark":"#EEFFFF","--shiki-light":"#90A4AE"}}," z "),i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-light":"#39ADB5"}},"="),i("span",{style:{"--shiki-dark":"#F78C6C","--shiki-light":"#F76D47"}}," 0.1"),i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-light":"#39ADB5"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#EEFFFF","--shiki-light":"#90A4AE"}},"console"),i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-light":"#39ADB5"}},"."),i("span",{style:{"--shiki-dark":"#82AAFF","--shiki-light":"#6182B8"}},"log"),i("span",{style:{"--shiki-dark":"#EEFFFF","--shiki-light":"#90A4AE"}},"("),i("span",{style:{"--shiki-dark":"#82AAFF","--shiki-light":"#6182B8"}},"equal"),i("span",{style:{"--shiki-dark":"#EEFFFF","--shiki-light":"#90A4AE"}},"(x "),i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-light":"#39ADB5"}},"+"),i("span",{style:{"--shiki-dark":"#EEFFFF","--shiki-light":"#90A4AE"}}," z"),i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-light":"#39ADB5"}},","),i("span",{style:{"--shiki-dark":"#EEFFFF","--shiki-light":"#90A4AE"}}," y))"),i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-light":"#39ADB5"}},";"),i("span",{style:{"--shiki-dark":"#545454","--shiki-dark-font-style":"italic","--shiki-light":"#90A4AE","--shiki-light-font-style":"italic"}}," // true")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#545454","--shiki-dark-font-style":"italic","--shiki-light":"#90A4AE","--shiki-light-font-style":"italic"}},"// 如果包含整数")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#C792EA","--shiki-light":"#9C3EDA"}},"function"),i("span",{style:{"--shiki-dark":"#82AAFF","--shiki-light":"#6182B8"}}," equal"),i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-light":"#39ADB5"}},"("),i("span",{style:{"--shiki-dark":"#EEFFFF","--shiki-dark-font-style":"italic","--shiki-light":"#90A4AE","--shiki-light-font-style":"italic"}},"x"),i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-light":"#39ADB5"}},","),i("span",{style:{"--shiki-dark":"#EEFFFF","--shiki-dark-font-style":"italic","--shiki-light":"#90A4AE","--shiki-light-font-style":"italic"}}," y"),i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-light":"#39ADB5"}},","),i("span",{style:{"--shiki-dark":"#EEFFFF","--shiki-dark-font-style":"italic","--shiki-light":"#90A4AE","--shiki-light-font-style":"italic"}}," tolerance"),i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-light":"#39ADB5"}}," ="),i("span",{style:{"--shiki-dark":"#EEFFFF","--shiki-light":"#90A4AE"}}," Number"),i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-light":"#39ADB5"}},"."),i("span",{style:{"--shiki-dark":"#EEFFFF","--shiki-light":"#90A4AE"}},"EPSILON"),i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-light":"#39ADB5"}},")"),i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-light":"#39ADB5"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-dark-font-style":"italic","--shiki-light":"#39ADB5","--shiki-light-font-style":"italic"}},"  return"),i("span",{style:{"--shiki-dark":"#EEFFFF","--shiki-light":"#90A4AE"}}," Math"),i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-light":"#39ADB5"}},"."),i("span",{style:{"--shiki-dark":"#82AAFF","--shiki-light":"#6182B8"}},"abs"),i("span",{style:{"--shiki-dark":"#F07178","--shiki-light":"#E53935"}},"("),i("span",{style:{"--shiki-dark":"#EEFFFF","--shiki-light":"#90A4AE"}},"x"),i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-light":"#39ADB5"}}," -"),i("span",{style:{"--shiki-dark":"#EEFFFF","--shiki-light":"#90A4AE"}}," y"),i("span",{style:{"--shiki-dark":"#F07178","--shiki-light":"#E53935"}},") "),i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-light":"#39ADB5"}},"<"),i("span",{style:{"--shiki-dark":"#EEFFFF","--shiki-light":"#90A4AE"}}," tolerance"),i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-light":"#39ADB5"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-light":"#39ADB5"}},"}")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#C792EA","--shiki-light":"#9C3EDA"}},"const"),i("span",{style:{"--shiki-dark":"#EEFFFF","--shiki-light":"#90A4AE"}}," x "),i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-light":"#39ADB5"}},"="),i("span",{style:{"--shiki-dark":"#F78C6C","--shiki-light":"#F76D47"}}," 1000.1"),i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-light":"#39ADB5"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#C792EA","--shiki-light":"#9C3EDA"}},"const"),i("span",{style:{"--shiki-dark":"#EEFFFF","--shiki-light":"#90A4AE"}}," y "),i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-light":"#39ADB5"}},"="),i("span",{style:{"--shiki-dark":"#F78C6C","--shiki-light":"#F76D47"}}," 1000.2"),i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-light":"#39ADB5"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#C792EA","--shiki-light":"#9C3EDA"}},"const"),i("span",{style:{"--shiki-dark":"#EEFFFF","--shiki-light":"#90A4AE"}}," z "),i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-light":"#39ADB5"}},"="),i("span",{style:{"--shiki-dark":"#F78C6C","--shiki-light":"#F76D47"}}," 2000.3"),i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-light":"#39ADB5"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#EEFFFF","--shiki-light":"#90A4AE"}},"console"),i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-light":"#39ADB5"}},"."),i("span",{style:{"--shiki-dark":"#82AAFF","--shiki-light":"#6182B8"}},"log"),i("span",{style:{"--shiki-dark":"#EEFFFF","--shiki-light":"#90A4AE"}},"("),i("span",{style:{"--shiki-dark":"#82AAFF","--shiki-light":"#6182B8"}},"equal"),i("span",{style:{"--shiki-dark":"#EEFFFF","--shiki-light":"#90A4AE"}},"(x "),i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-light":"#39ADB5"}},"+"),i("span",{style:{"--shiki-dark":"#EEFFFF","--shiki-light":"#90A4AE"}}," y"),i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-light":"#39ADB5"}},","),i("span",{style:{"--shiki-dark":"#EEFFFF","--shiki-light":"#90A4AE"}}," z"),i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-light":"#39ADB5"}},","),i("span",{style:{"--shiki-dark":"#F78C6C","--shiki-light":"#F76D47"}}," 2000"),i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-light":"#39ADB5"}}," *"),i("span",{style:{"--shiki-dark":"#EEFFFF","--shiki-light":"#90A4AE"}}," Number"),i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-light":"#39ADB5"}},"."),i("span",{style:{"--shiki-dark":"#EEFFFF","--shiki-light":"#90A4AE"}},"EPSILON))"),i("span",{style:{"--shiki-dark":"#89DDFF","--shiki-light":"#39ADB5"}},";"),i("span",{style:{"--shiki-dark":"#545454","--shiki-dark-font-style":"italic","--shiki-light":"#90A4AE","--shiki-light-font-style":"italic"}}," // true")])])]),i("button",{class:"collapse"})],-1))]),"main-header":a(()=>[k(l.$slots,"main-header")]),"main-header-after":a(()=>[k(l.$slots,"main-header-after")]),"main-nav":a(()=>[k(l.$slots,"main-nav")]),"main-content":a(()=>[k(l.$slots,"main-content")]),"main-content-after":a(()=>[k(l.$slots,"main-content-after")]),"main-nav-before":a(()=>[k(l.$slots,"main-nav-before")]),"main-nav-after":a(()=>[k(l.$slots,"main-nav-after")]),comment:a(()=>[k(l.$slots,"comment")]),footer:a(()=>[k(l.$slots,"footer")]),aside:a(()=>[k(l.$slots,"aside")]),"aside-custom":a(()=>[k(l.$slots,"aside-custom")]),default:a(()=>[k(l.$slots,"default")]),_:3},8,["frontmatter"])}}};export{B as default};
